
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Shadama2 5</title>
		<script src="minMatrixb.js" type="text/javascript"></script>
		<script src="shadama.js" type="text/javascript"></script>

        <script id="forward.vert" type="x-shader/x-vertex">
attribute vec2 a_position;

uniform vec2 u_resolution;
uniform sampler2D u_position;
uniform float u_amount;

varying vec4 vColor;

vec2 decodePos(vec4 c) {
    return c.rg;
}

vec2 decodeDir(vec4 c) {
    return c.ba;
}

vec4 encodeVal(vec2 pos, vec2 dir) {
    return vec4(mod(pos, 256.0), dir);
}

void main(void) {
    vec2 zeroToOne = a_position / u_resolution;
    vec2 zeroToTwo = zeroToOne * 2.0;
    vec2 clipSpace = zeroToTwo - 1.0;
    gl_Position = vec4(clipSpace, 0, 1);

    vec4 val = texture2D(u_position, zeroToOne);
    vec2 dPos = decodePos(val);
    vec2 dDir = decodeDir(val);
    vec2 newPos = dPos + (dDir * u_amount);
    vColor = encodeVal(newPos, dDir);
    gl_PointSize = 1.0;
}
        </script>
        <script id="forward.frag" type="x-shader/x-fragment">
precision mediump float;

varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
        </script>

        <script id="renderBreed.vert" type="x-shader/x-vertex">
attribute vec2 a_position;

uniform vec2 u_resolution;
uniform sampler2D u_position;

vec2 decodePos(vec4 c) {
    return c.rg;
}

void main(void) {
    vec2 zeroToOne = a_position / u_resolution;

    vec4 val = texture2D(u_position, zeroToOne);
    vec2 dPos = decodePos(val);   // (0-256.0, 0-256.0)
    vec2 normPos = dPos / 256.0;  // (0-1.0, 0-1.0)
    vec2 normPos2 = normPos * 2.0;  // (0-2.0, 0-2.0)
    vec2 clipPos = normPos2 - 1.0;  // (-1.0-1.0, -1.0-1.0)

    gl_Position = vec4(clipPos, 0, 1.0);
    gl_PointSize = 1.0;
}
        </script>

        <script id="renderBreed.frag" type="x-shader/x-fragment">
precision mediump float;

uniform    vec4 u_color;

void main(void) {
  gl_FragColor = u_color;
}
        </script>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<canvas id="debugCanvas1"></canvas>
		<canvas id="debugCanvas2"></canvas>
		<div id="readout"</div>
	</body>
</html>
