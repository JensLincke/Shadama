
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>Shadama2</title>
		<script src="minMatrixb.js" type="text/javascript"></script>
		<script src="shadama.js" type="text/javascript"></script>

        <script id="forward.vert" type="x-shader/x-vertex">
attribute vec2 a_position;

uniform vec2 u_resolution;
uniform float u_particleLength;
uniform sampler2D u_position;
uniform float u_amount;

varying vec4 vColor;

vec2 decodePos(vec4 c) {
    return c.rg;
}

vec2 decodeDir(vec4 c) {
    return c.ba;
}

vec4 encodeVal(vec2 pos, vec2 dir) {
    return vec4(mod(pos, u_resolution), dir);
}

void main(void) {
    vec2 zeroToOne = a_position / u_particleLength;
    vec2 oneToOne = zeroToOne * 2.0 - 1.0;
    gl_Position = vec4(oneToOne, 0, 1);

    vec4 val = texture2D(u_position, zeroToOne);
    vec2 dPos = decodePos(val);
    vec2 dDir = decodeDir(val);
    vec2 newPos = dPos + (dDir * u_amount);
    vColor = encodeVal(newPos, dDir);
    gl_PointSize = 1.0;
}
        </script>
        <script id="forward.frag" type="x-shader/x-fragment">
precision mediump float;

varying vec4 vColor;

void main(void) {
    gl_FragColor = vColor;
}
        </script>

        <script id="renderBreed.vert" type="x-shader/x-vertex">
attribute vec2 a_position;

uniform vec2 u_resolution;
uniform float u_particleLength;
uniform sampler2D u_position;

varying vec2 v_coord;

vec2 decodePos(vec4 c) {
    return c.rg;
}

void main(void) {
    vec2 zeroToOne = a_position / u_particleLength;

    vec4 val = texture2D(u_position, zeroToOne);
    vec2 dPos = decodePos(val);   // (0-resolution, 0-resolution)
    vec2 normPos = dPos / u_resolution;  // (0-1.0, 0-1.0)
    vec2 clipPos = normPos * 2.0 - 1.0;  // (-1.0-1.0, -1.0-1.0)

    v_coord = zeroToOne;

    gl_Position = vec4(clipPos, 0, 1.0);
    gl_PointSize = 1.0;
}
        </script>

        <script id="renderBreed.frag" type="x-shader/x-fragment">
precision mediump float;

uniform sampler2D u_color;

varying vec2 v_coord;

void main(void) {
  gl_FragColor = texture2D(u_color, v_coord);
}
        </script>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<canvas id="debugCanvas1"></canvas>
		<canvas id="debugCanvas2"></canvas>
		<div id="readout"</div>
	</body>
</html>
